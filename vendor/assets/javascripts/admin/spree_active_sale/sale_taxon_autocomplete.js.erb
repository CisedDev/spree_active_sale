// $(document).ready(function() {

//   if ($("#active_sale_event_taxon_ids").length > 0) {
//     $("#active_sale_event_taxon_ids").select2({
//       placeholder: Spree.translations.taxon_placeholder,
//       multiple: true,
//       initSelection: function(element, callback) {
//         console.log(Spree.api_key);
//         var url = Spree.url(Spree.routes.taxons_search, {
//           ids: element.val(),
//           token: Spree.api_key
//         });
//         console.log(url);
//         return $.getJSON(url, null, function(data) {
//           return callback(data);
//         })
//       },
//       ajax: {
//         url: Spree.routes.taxons_search,
//         datatype: 'json',

//         data: function(term, page) {
//           return { q:
//             { name_cont: term },
//             token: Spree.api_key
//           }
//         },
//         results: function (data, page) {
//           return { results: data }
//         }
//       },
//       formatResult: function(taxon) {
//         return taxon.pretty_name
//       },
//       formatSelection: function(taxon) {
//         return taxon.pretty_name
//       }
//     })
//   }
// });

// 'use strict';

var set_taxon_select = function(selector){
  if ($(selector).length > 0) {
    $(selector).select2({
      placeholder: Spree.translations.taxon_placeholder,
      multiple: true,
      initSelection: function (element, callback) {
        var url = Spree.url(Spree.routes.taxons_search, {
          ids: element.val(),
          token: Spree.api_key
        });
        return $.getJSON(url, null, function (data) {
          return callback(data['taxons']);
        });
      },
      ajax: {
        url: Spree.routes.taxons_search,
        datatype: 'json',
        data: function (term, page) {
          return {
            per_page: 50,
            page: page,
            without_children: true,
            q: {
              name_cont: term
            },
            token: Spree.api_key
          };
        },
        results: function (data, page) {
          var more = page < data.pages;
          return {
            results: data['taxons'],
            more: more
          };
        }
      },
      formatResult: function (taxon) {
        return taxon.pretty_name;
      },
      formatSelection: function (taxon) {
        return taxon.pretty_name;
      }
    });
  }
}

$(document).ready(function () {
  set_taxon_select('#active_sale_event_taxon_ids')
});
